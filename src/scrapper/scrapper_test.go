package scrapper

import (
	"fmt"
	"net/http"
	"net/http/httptest"
	"reflect"
	"testing"

	"github.com/gufranmirza/imdb-cli/src/models"
)

func Test_scrap_GetMovie(t *testing.T) {
	var response = `<div id="title-overview-widget" class="heroic-overview"> <div class="vital"> <div id="quicklinksBar" class="subnav"> <div id="quicklinksMainSection"> <a href="/title/tt0048473/fullcredits?ref_=tt_ql_1" class="quicklink">FULL CAST AND CREW</a> <span class="ghost">|</span> <a href="/title/tt0048473/trivia?ref_=tt_ql_2" class="quicklink">TRIVIA</a> <span class="ghost">|</span> <a href="/title/tt0048473/reviews?ref_=tt_ql_3" class="quicklink">USER REVIEWS</a> <span class="ghost">|</span> <a href="https://pro.imdb.com/title/tt0048473?rf=cons_tt_contact&amp;ref_=cons_tt_contact" class="quicklink">IMDbPro</a> <span class="ghost">|</span> <span class="show_more quicklink"> MORE<span class="titleOverviewSprite quicklinksArrowUp"></span> </span> <span class="show_less quicklink" style="display:none"> LESS<span class="titleOverviewSprite quicklinksArrowDown"></span> </span> </div> <span id="title-social-sharing-widget"><div class="dropdown share-widget"><button title="Share" class="quicklink"><span class="quicklink">SHARE</span></button><div class="dropdown-menu menu-right"><div class="dropdown-menu-item"><a href="http://www.facebook.com/sharer.php?u=https%3A%2F%2Fwww.imdb.com%2Ftitle%2Ftt0048473%2F" title="Share on Facebook" windowwidth="626" windowheight="436" target="_blank"><span class="share-widget-sprite share facebook"></span>Facebook</a></div><div class="dropdown-menu-item"><a tweet="Pather Panchali (1955) - IMDb" href="http://twitter.com/intent/tweet?text=Pather%20Panchali%20(1955)%20-%20IMDb%20-%20https%3A%2F%2Fwww.imdb.com%2Ftitle%2Ftt0048473%2F" title="Share on Twitter" windowwidth="815" windowheight="436" target="_blank"><span class="share-widget-sprite share twitter"></span>Twitter</a></div><div class="dropdown-menu-item"><a href="mailto:?subject=Check%20out%20this%20link%20on%20IMDb!&amp;body=Pather%20Panchali%20(1955)%20-%20IMDb - https://www.imdb.com/title/tt0048473/" title="Share by email"><span class="share-widget-sprite share email"></span>Email</a></div><div class="dropdown-menu-item"><div class="checkin-menu-item"><span class="open-checkin-popover"><span class="share-widget-sprite share checkin"></span>Check in</span></div></div><div class="dropdown-menu-item"><a href="https://www.imdb.com/title/tt0048473/" title="Click to copy"><span class="share-widget-copy-icon"><span class="share-widget-sprite share link"></span></span><div class="share-link-descriptor">Copy</div><div class="share-link-textbox"><input type="text" readonly="" value="https://www.imdb.com/title/tt0048473/"></div></a></div></div><div class="dropdown-overlay"></div></div></span> <div id="share-checkin"> <div class="add_to_checkins" data-const="tt0048473" data-lcn="title-maindetails"> <span class="btn2_wrapper"><a onclick="" class="btn2 large btn2_text_on checkins_action_btn"><span class="btn2_glyph">0</span><span class="btn2_text">Check in</span></a></span>    <div class="popup checkin-dialog" style="display: none;"> <a class="dialog-close-button">X</a> <span class="title">I'm Watching This!</span> <div class="body"> <div class="info">Keep track of everything you watch; tell your friends. </div> <div class="small message_box"> <div class="hidden error" style="display: none;"><h2><div class="checkin-error">Error</div></h2> Please try again!</div> <div class="hidden success" style="display: none;"><h2><div class="checkin-success">Added to Your Check-Ins.</div></h2> <a href="/list/checkins">View</a></div> </div> <textarea data-msg="Enter a comment..." class="placeholder"></textarea> <div class="share"> <button class="checkin-button"><span>Check in</span></button> <!-- Check-ins are more fun when<br> you <a href="/register/sharing">enable Facebook sharing</a>! --> </div> </div> </div> <input type="hidden" name="49e6c" value="2984"> </div> </div> <div class="quicklinkSection" id="full_subnav" style="display:none"> <div class="quicklinkSectionColumn"> <div class="quicklinkGroup"> <div class="quicklinkSectionHeader">DETAILS</div> <div class="quicklinkSectionItem"> <a href="/title/tt0048473/fullcredits?ref_=tt_ql_dt_1" class="quicklink">Full Cast and Crew</a>            </div> <div class="quicklinkSectionItem"> <a href="/title/tt0048473/releaseinfo?ref_=tt_ql_dt_2" class="quicklink">Release Dates</a>            </div> <div class="quicklinkSectionItem"> <a href="/title/tt0048473/officialsites?ref_=tt_ql_dt_3" class="quicklink quicklinkGray">Official Sites</a>            </div> <div class="quicklinkSectionItem"> <a href="/title/tt0048473/companycredits?ref_=tt_ql_dt_4" class="quicklink">Company Credits</a>            </div> <div class="quicklinkSectionItem"> <a href="/title/tt0048473/locations?ref_=tt_ql_dt_5" class="quicklink">Filming &amp; Production</a>            </div> <div class="quicklinkSectionItem"> <a href="/title/tt0048473/technical?ref_=tt_ql_dt_6" class="quicklink">Technical Specs</a>            </div> </div> </div> <div class="quicklinkSectionColumn"> <div class="quicklinkGroup"> <div class="quicklinkSectionHeader">STORYLINE</div> <div class="quicklinkSectionItem"> <a href="/title/tt0048473/taglines?ref_=tt_ql_stry_1" class="quicklink">Taglines</a>            </div> <div class="quicklinkSectionItem"> <a href="/title/tt0048473/plotsummary?ref_=tt_ql_stry_2" class="quicklink">Plot Summary</a>            </div> <div class="quicklinkSectionItem"> <a href="/title/tt0048473/synopsis?ref_=tt_ql_stry_3" class="quicklink">Synopsis</a>            </div> <div class="quicklinkSectionItem"> <a href="/title/tt0048473/keywords?ref_=tt_ql_stry_4" class="quicklink">Plot Keywords</a>            </div> <div class="quicklinkSectionItem"> <a href="/title/tt0048473/parentalguide?ref_=tt_ql_stry_5" class="quicklink">Parents Guide</a>            </div> </div> <div class="quicklinkGroup"> <div class="quicklinkSectionHeader">RELATED ITEMS</div> <div class="quicklinkSectionItem"> <a href="/title/tt0048473/news?ref_=tt_ql_rel_1" class="quicklink">News</a>            </div> <div class="quicklinkSectionItem"> <a href="/title/tt0048473/externalsites?ref_=tt_ql_rel_2" class="quicklink">External Sites</a>            </div> </div> </div> <div class="quicklinkSectionColumn"> <div class="quicklinkGroup"> <div class="quicklinkSectionHeader">OPINION</div> <div class="quicklinkSectionItem"> <a href="/title/tt0048473/awards?ref_=tt_ql_op_1" class="quicklink">Awards</a>            </div> <div class="quicklinkSectionItem"> <a href="/title/tt0048473/faq?ref_=tt_ql_op_2" class="quicklink">FAQ</a>            </div> <div class="quicklinkSectionItem"> <a href="/title/tt0048473/reviews?ref_=tt_ql_op_3" class="quicklink">User Reviews</a>            </div> <div class="quicklinkSectionItem"> <a href="/title/tt0048473/ratings?ref_=tt_ql_op_4" class="quicklink">User Ratings</a>            </div> <div class="quicklinkSectionItem"> <a href="/title/tt0048473/externalreviews?ref_=tt_ql_op_5" class="quicklink">External Reviews</a>            </div> <div class="quicklinkSectionItem"> <a href="/title/tt0048473/criticreviews?ref_=tt_ql_op_6" class="quicklink quicklinkGray">Metacritic Reviews</a>            </div> </div> <div class="quicklinkGroup"> <div class="quicklinkSectionHeader">PHOTO &amp; VIDEO</div> <div class="quicklinkSectionItem"> <a href="/title/tt0048473/mediaindex?ref_=tt_ql_pv_1" class="quicklink">Photo Gallery</a>            </div> <div class="quicklinkSectionItem"> <a href="/title/tt0048473/videogallery?ref_=tt_ql_pv_2" class="quicklink">Trailers and Videos</a>            </div> </div> </div> <div class="quicklinkSectionColumn"> <div class="quicklinkGroup"> <div class="quicklinkSectionHeader">DID YOU KNOW?</div> <div class="quicklinkSectionItem"> <a href="/title/tt0048473/trivia?ref_=tt_ql_trv_1" class="quicklink">Trivia</a>            </div> <div class="quicklinkSectionItem"> <a href="/title/tt0048473/goofs?ref_=tt_ql_trv_2" class="quicklink">Goofs</a>            </div> <div class="quicklinkSectionItem"> <a href="/title/tt0048473/crazycredits?ref_=tt_ql_trv_3" class="quicklink quicklinkGray">Crazy Credits</a>            </div> <div class="quicklinkSectionItem"> <a href="/title/tt0048473/quotes?ref_=tt_ql_trv_4" class="quicklink">Quotes</a>            </div> <div class="quicklinkSectionItem"> <a href="/title/tt0048473/alternateversions?ref_=tt_ql_trv_5" class="quicklink quicklinkGray">Alternate Versions</a>            </div> <div class="quicklinkSectionItem"> <a href="/title/tt0048473/movieconnections?ref_=tt_ql_trv_6" class="quicklink">Connections</a>            </div> <div class="quicklinkSectionItem"> <a href="/title/tt0048473/soundtrack?ref_=tt_ql_trv_7" class="quicklink">Soundtracks</a>            </div> </div> </div> </div> </div> <div class="title_block"> <div class="title_bar_wrapper"> <div class="ratings_wrapper"> <div class="imdbRating" itemtype="http://schema.org/AggregateRating" itemscope="" itemprop="aggregateRating"> <div class="ratingValue"> <strong title="8.6 based on 22,843 user ratings"><span itemprop="ratingValue">8.6</span></strong><span class="grey">/</span><span class="grey" itemprop="bestRating">10</span>                    </div> <a href="/title/tt0048473/ratings?ref_=tt_ov_rt"><span class="small" itemprop="ratingCount">22,843</span></a> <div class="hiddenImportant"> <span itemprop="reviewCount">136 user</span> <span itemprop="reviewCount">117 critic</span> </div> </div> <div id="star-rating-widget" class="star-rating-widget" data-tconst="tt0048473" data-rating="0" data-user="" data-auth="" data-tracking-tag="title-maindetails" data-rating-share-enabled="false" data-title="Pather Panchali" data-rating-next-share-time="2000-01-01T00:00:00.000Z" data-rating-share-treatment="C"><div class="star-rating-button"><button><span class="star-rating-star no-rating"></span><span class="star-rating-text">Rate This</span></button><div value="0" ratetext="Rate This" ratesubtext="You" class="star-rating"><span><a class="star-rating-delete" title="Delete" rel="nofollow"></a><span class="star-rating-stars"><a class="" title="Click to rate: 1" rel="nofollow"><span>1</span></a><a class="" title="Click to rate: 2" rel="nofollow"><span>2</span></a><a class="" title="Click to rate: 3" rel="nofollow"><span>3</span></a><a class="" title="Click to rate: 4" rel="nofollow"><span>4</span></a><a class="" title="Click to rate: 5" rel="nofollow"><span>5</span></a><a class="" title="Click to rate: 6" rel="nofollow"><span>6</span></a><a class="" title="Click to rate: 7" rel="nofollow"><span>7</span></a><a class="" title="Click to rate: 8" rel="nofollow"><span>8</span></a><a class="" title="Click to rate: 9" rel="nofollow"><span>9</span></a><a class="" title="Click to rate: 10" rel="nofollow"><span>10</span></a></span></span><span class="star-rating-value">0</span></div></div></div> </div> <div class="titleBar"> <div class="primary_ribbon"> <div class="ribbonize" data-tconst="tt0048473" data-caller-name="title" style="position: relative;"><div class="wl-ribbon standalone not-inWL" title="Click to add to watchlist"></div></div> <div class="wlb_dropdown_btn btn2_wrapper btn2_active wlb_dropdown" data-tconst="tt0048473" data-size="large" data-caller-name="title" data-type="primary" data-initialized="1"><div class="btn2_alert" style="display:none"></div><a class="btn2 large primary btn2_glyph_on" onclick=""><span class="btn2_glyph"><div class="btn2_down"></div></span><span class="btn2_text"></span></a></div> <div class="wlb_dropdown_list" style="display:none"></div> </div> <div class="title_wrapper"> <h1 class="">Pather Panchali&nbsp;<span id="titleYear">(<a href="/year/1955/?ref_=tt_ov_inf">1955</a>)</span>            </h1> <div class="subtext"> Not Rated <span class="ghost">|</span>                    <time datetime="PT125M"> 2h 5min </time> <span class="ghost">|</span> <a href="/search/title?genres=drama&amp;explore=title_type,genres&amp;ref_=tt_ov_inf">Drama</a> <span class="ghost">|</span> <a href="/title/tt0048473/releaseinfo?ref_=tt_ov_inf" title="See more release dates">26 August 1955 (India) </a>            </div> </div> </div> </div> </div> <div class="slate_wrapper"> <div class="poster"> <a href="/title/tt0048473/mediaviewer/rm2023787521?ref_=tt_ov_i"> <img alt="Pather Panchali Poster" title="Pather Panchali Poster" src="https://m.media-amazon.com/images/M/MV5BNDE5YmMxYjEtZjNjNC00NjM2LWE2ZjctOTkyNGMxODRiMGNiXkEyXkFqcGdeQXVyNTgyNTA4MjM@._V1_UY268_CR4,0,182,268_AL__QL50.jpg"> </a>    </div> <!--Begin inline video hero weblab check--> <div class="slate"> <a href="/video/imdb/vi3114774553?playlistId=tt0048473&amp;ref_=tt_ov_vi" class="slate_button prevent-ad-overlay video-modal" data-type="recommends" data-tconst="tt0048473" data-video="vi3114774553" data-context="imdb" data-refsuffix="tt_ov_vi" data-pixels=""> <img alt="Trailer" title="Trailer" src="https://m.media-amazon.com/images/M/MV5BMTg1OTg5NTYxN15BMl5BanBnXkFtZTgwNDA4MjY1NTE@._V1_UX477_CR0,0,477,268_AL__QL50.jpg"> <div class="slate_fade_top"></div> <div class="slate_fade_bottom"></div> </a>        <div class="caption"> <div style="float: left;">2:03 <span class="ghost">|</span> Trailer</div> <div style="float: right;">        <a href="/title/tt0048473/videogallery?ref_=tt_ov_vi_sm">2 VIDEOS</a> <span class="ghost">|</span>        <a href="/title/tt0048473/mediaindex?ref_=tt_ov_mi_sm">61 IMAGES</a> </div> <div style="clear: both;"></div> </div> </div> </div> </div> <script type="text/javascript"> window.IMDbLocalizedPlots = { titleId: "tt0048473", t1:false, t2:true }; </script> <div class="plot_summary_wrapper localized"> <script> if ('csm' in window) { csm.measure('csm_TitlePlotAndCreditSummaryWidget_started'); } </script> <div class="plot_summary "> <div class="summary_text ready"><div class="localized-plot "><div class="plot-text"><div class="ipc-html-content ipc-html-content--base"><div> Impoverished priest Harihar Ray, dreaming of a better life for himself and his family, leaves his rural Bengal village in search of work. </div></div></div><div class="locale-select"><div class="locale-label"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" class="ipc-icon ipc-icon--language" viewBox="0 0 24 24" fill="currentColor" role="presentation"><path fill="none" d="M0 0h24v24H0V0z"></path><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zm6.93 6h-2.95c-.32-1.25-.78-2.45-1.38-3.56 1.84.63 3.37 1.91 4.33 3.56zM12 4.04c.83 1.2 1.48 2.53 1.91 3.96h-3.82c.43-1.43 1.08-2.76 1.91-3.96zM4.26 14C4.1 13.36 4 12.69 4 12s.1-1.36.26-2h3.38c-.08.66-.14 1.32-.14 2s.06 1.34.14 2H4.26zm.82 2h2.95c.32 1.25.78 2.45 1.38 3.56-1.84-.63-3.37-1.9-4.33-3.56zm2.95-8H5.08c.96-1.66 2.49-2.93 4.33-3.56C8.81 5.55 8.35 6.75 8.03 8zM12 19.96c-.83-1.2-1.48-2.53-1.91-3.96h3.82c-.43 1.43-1.08 2.76-1.91 3.96zM14.34 14H9.66c-.09-.66-.16-1.32-.16-2s.07-1.35.16-2h4.68c.09.65.16 1.32.16 2s-.07 1.34-.16 2zm.25 5.56c.6-1.11 1.06-2.31 1.38-3.56h2.95c-.96 1.65-2.49 2.93-4.33 3.56zM16.36 14c.08-.66.14-1.32.14-2s-.06-1.34-.14-2h3.38c.16.64.26 1.31.26 2s-.1 1.36-.26 2h-3.38z"></path></svg> EN<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" class="ipc-icon ipc-icon--arrow-drop-down" viewBox="0 0 24 24" fill="currentColor" role="presentation"><path fill="none" d="M0 0h24v24H0V0z"></path><path d="M8.71 11.71l2.59 2.59c.39.39 1.02.39 1.41 0l2.59-2.59c.63-.63.18-1.71-.71-1.71H9.41c-.89 0-1.33 1.08-.7 1.71z"></path></svg></div></div></div></div> <div class="credit_summary_item"> <h4 class="inline">Director:</h4> <a href="/name/nm0006249/?ref_=tt_ov_dr">Satyajit Ray</a>    </div> <div class="credit_summary_item"> <h4 class="inline">Writers:</h4> <a href="/name/nm0051808/?ref_=tt_ov_wr">Bibhutibhushan Bandyopadhyay</a> (novel), <a href="/name/nm0006249/?ref_=tt_ov_wr">Satyajit Ray</a> (screenplay)    </div> <div class="credit_summary_item"> <h4 class="inline">Stars:</h4> <a href="/name/nm0052333/?ref_=tt_ov_st_sm">Kanu Bannerjee</a>, <a href="/name/nm0052334/?ref_=tt_ov_st_sm">Karuna Bannerjee</a>, <a href="/name/nm0052343/?ref_=tt_ov_st_sm">Subir Banerjee</a>            <span class="ghost">|</span> <a href="fullcredits/?ref_=tt_ov_st_sm">See full cast &amp; crew</a>&nbsp;» </div> </div> <script> if ('csm' in window) { csm.measure('csm_TitlePlotAndCreditSummaryWidget_finished'); } </script> <!--To display Pro Title CTA above the watchlist for in-development titles --> <div class="watchlist-watchbox--titlemain"> <div class="buybox buybox--default buybox--desktop"> <a href="/offsite/?page-action=offsite-erosnow&amp;token=BCYpzppF5UX_UUCAj4oR-nH5Qya3brAaqRfW_Kn8LOuRxohG_n0rrtMtYo0uSM-BGW7DQ68ThW75%0D%0ANY5eZwA46Tgk_8n3hoQaHEw7Zmthi7UvdogAxuMLw-qTTp7ov8-QOOEpVjHFsbD4bzFqzAZ-JQsp%0D%0AzkG5aeljztMDLVTNPAGHd3XOTsuAlwS_XwshjBSUIVPu%0D%0A&amp;ref_=tt_wbr_eros_in" class="ipc-button ipc-button buybox__button promoted-watch-ad ipc-button--core-base ipc-button--full-width ipc-button--default-height" target="_blank" rel="nofollow" data-ipc-data="/offsite/?page-action=offsite-erosnow&amp;token=BCYpzppF5UX_UUCAj4oR-nH5Qya3brAaqRfW_Kn8LOuRxohG_n0rrtMtYo0uSM-BGW7DQ68ThW75%0D%0ANY5eZwA46Tgk_8n3hoQaHEw7Zmthi7UvdogAxuMLw-qTTp7ov8-QOOEpVjHFsbD4bzFqzAZ-JQsp%0D%0AzkG5aeljztMDLVTNPAGHd3XOTsuAlwS_XwshjBSUIVPu%0D%0A&amp;ref_=tt_wbr_eros_in"> <div class="ipc-button__text">        <div class="buybox__body promoted-watch-ad-link"> <div class="buybox__icon"> <svg width="32" height="32" xmlns="http://www.w3.org/2000/svg"> <g fill="none" fill-rule="evenodd"><path d="M0 0h32v32H0z"></path> <g transform="translate(4 4)"> <circle stroke="#FFF" stroke-width="2" cx="12" cy="12" r="12"></circle> <path fill="#FFF" d="M19 12L9 19V5z"></path> </g> </g> </svg> </div> <div class="buybox__content"> <span class="buybox__cta"> Watch on ErosNow <svg width="24" height="24" xmlns="http://www.w3.org/2000/svg" class="ipc-icon ipc-icon--launch-inline ipc-icon--inline " viewBox="0 0 24 24" fill="currentColor" role="presentation"><path d="M21.6 21.6H2.4V2.4h7.2V0H0v24h24v-9.6h-2.4v7.2zM14.4 0v2.4h4.8L7.195 14.49l2.4 2.4L21.6 4.8v4.8H24V0h-9.6z"></path></svg> </span> <span class="buybox__description">Go to erosnow.com</span> </div> </div> </div> </a> <a href="#" class="ipc-button ipc-secondary-button buybox__more buybox__modal ipc-button--core-base ipc-button--on-accent2 ipc-button--single-padding ipc-button--default-height" data-ipc-data="/watch/_ajax/box/tt0048473/?ref_=m_tt_wbr_sm"> <div class="ipc-button__text"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" class="ipc-icon ipc-icon--more-horiz  " viewBox="0 0 24 24" fill="currentColor" role="presentation"><path fill="none" d="M0 0h24v24H0V0z"></path><path d="M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"></path></svg></div> </a> </div> <div class="watchlist-watchbox-divider"></div> <div class="uc-add-wl-button uc-add-wl--not-in-wl uc-add-wl" data-title-id="tt0048473" data-is-logged-in="false" data-is-watchlisted="false" title="Click to add to watchlist" data-widget-type="wl_button" data-ref-tag-prefix="tt_ov" data-record-metric="true" data-uc-add-wl=""> <button class="ipc-button ipc-secondary-button uc-add-wl-button-icon--done watchlist--title-main-desktop ipc-button--core-base ipc-button--on-textPrimary ipc-button--single-padding ipc-button--default-height"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" class="ipc-icon ipc-icon--done  ipc-button__icon ipc-button__icon--pre" viewBox="0 0 24 24" fill="currentColor" role="presentation"><path fill="none" d="M0 0h24v24H0V0z"></path><path d="M9 16.2l-3.5-3.5a.984.984 0 0 0-1.4 0 .984.984 0 0 0 0 1.4l4.19 4.19c.39.39 1.02.39 1.41 0L20.3 7.7a.984.984 0 0 0 0-1.4.984.984 0 0 0-1.4 0L9 16.2z"></path></svg>    <div class="ipc-button__text">Added to Watchlist</div> </button> <button class="ipc-button ipc-secondary-button uc-add-wl-button-icon--add watchlist--title-main-desktop ipc-button--core-base ipc-button--on-textPrimary ipc-button--single-padding ipc-button--default-height"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" class="ipc-icon ipc-icon--add  ipc-button__icon ipc-button__icon--pre" viewBox="0 0 24 24" fill="currentColor" role="presentation"><path fill="none" d="M0 0h24v24H0V0z"></path><path d="M18 13h-5v5c0 .55-.45 1-1 1s-1-.45-1-1v-5H6c-.55 0-1-.45-1-1s.45-1 1-1h5V6c0-.55.45-1 1-1s1 .45 1 1v5h5c.55 0 1 .45 1 1s-.45 1-1 1z"></path></svg>    <div class="ipc-button__text">Add to Watchlist</div> </button> <div class="uc-add-wl-pending-icon"></div> </div> </div> <script> if ('csm' in window) { csm.measure('csm_TitleReviewsAndPopularityWidget_started'); } </script> <div class="titleReviewBar "> <div class="titleReviewBarItem titleReviewbarItemBorder"> <div> Reviews </div> <div> <span class="subText"> <a href="reviews?ref_=tt_ov_rt">136 user</a> <span class="ghostText">|</span> <a href="externalreviews?ref_=tt_ov_rt">117 critic</a> </span> </div> </div> </div> <script> if ('csm' in window) { csm.measure('csm_TitleReviewsAndPopularityWidget_finished'); } </script> </div> <!--To display Pro Title CTA below the review bar for completed titles --> <div class="pro_logo_main_title"> <div id="title_completed_pro_link" class="pro_title_link_with_separator"> <a href="https://pro.imdb.com/title/tt0048473?rf=cons_tt_atf&amp;ref_=cons_tt_atf" class="pro_title_href"> <img src="https://m.media-amazon.com/images/G/01/imdb/IMDbConsumerSiteProTitleViews/images/logo/pro_logo_dark-3176609149._CB468516142_.png" class="pro_logo"> <span class="pro_title_link_text"> View production, box office, &amp; company info </span> <img src="https://m.media-amazon.com/images/G/01/imdb/IMDbConsumerSiteProTitleViews/images/icons/link_2x-1783866327._CB468224098_.png" class="pro_link_icon"> </a>    </div> </div> </div>`
	server := httptest.NewServer(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
		w.Header().Set("Content-Type", "text/html")
		if r.URL.Path == "/" {
			fmt.Fprintln(w, response)
		}
		fmt.Fprintln(w, "404 Not Found")
	}))
	defer server.Close()

	type args struct {
		url string
	}
	tests := []struct {
		name    string
		s       *scrap
		args    args
		want    *models.Movie
		wantErr bool
	}{
		{
			name: "Happy Path - Successfully Parsing Movie",
			args: args{
				url: server.URL,
			},
			want: &models.Movie{
				Title:            "Pather Panchali (1955)",
				MovieReleaseYear: "1955",
				IMDBRating:       "8.6",
				Summary:          "Impoverished priest Harihar Ray, dreaming of a better life for himself and his family, leaves his rural Bengal village in search of work.  EN",
				Duration:         "2h 5min",
				Genre:            "Drama",
			},
		},
		{
			name: "No Movie details Found",
			args: args{
				url: fmt.Sprintf("%s/%s", server.URL, "some-404-url"),
			},
			want: &models.Movie{},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			s := &scrap{}
			got, err := s.GetMovie(tt.args.url)
			if (err != nil) != tt.wantErr {
				t.Errorf("scrap.GetMovie() error = %v, wantErr %v", err, tt.wantErr)
				return
			}
			fmt.Printf("%+v", got)
			if !reflect.DeepEqual(got, tt.want) {
				t.Errorf("scrap.GetMovie() = %v, want %v", got, tt.want)
			}
		})
	}
}

func Test_scrap_GetTopMoviesURL(t *testing.T) {
	var response = `<div class="lister"><div><div class="nav"><div class="controls float-right lister-activated" style="display:block"><label class="lister-sort-by-label" for="lister-sort-by-options">Sort by:</label><select id="lister-sort-by-options" name="sort" class="lister-sort-by"><option value="rk:ascending" selected>Ranking</option><option value="ir:descending">IMDb Rating</option><option value="us:descending">Release Date</option><option value="nv:descending">Number of Ratings</option><option value="ur:descending">Your Rating</option></select><span class="global-sprite lister-sort-reverse descending" data-sort="rk:desc" title="Ascending order"></span></div><div class="desc">Showing <span>250</span> Titles</div></div></div><br class="clear"><table class="chart full-width" data-caller-name="imdb-featured-india"><colgroup><col class="chartTableColumnPoster"><col class="chartTableColumnTitle"><col class="chartTableColumnIMDbRating"><col class="chartTableColumnYourRating"><col class="chartTableColumnWatchlistRibbon"></colgroup><thead><tr><th></th><th>Rank &amp; Title</th><th>IMDb Rating</th><th>Your Rating</th><th></th></tr></thead><tbody class="lister-list"><tr><td class="posterColumn"><span name="rk" data-value="1"></span> <span name="ir" data-value="8.51377367086723"></span> <span name="us" data-value="-4.529088E11"></span> <span name="nv" data-value="22843"></span> <span name="ur" data-value="-2.4862263291327693"></span> <a href="/title/tt0048473/?pf_rd_m=A2FGELUUNOQJNL&amp;pf_rd_p=690bec67-3bd7-45a1-9ab4-4f274a72e602&amp;pf_rd_r=6SQY242HSENKQ6HKJAR9&amp;pf_rd_s=center-4&amp;pf_rd_t=60601&amp;pf_rd_i=india.top-rated-indian-movies&amp;ref_=fea_india_ss_toprated_tt_1"><img src="https://m.media-amazon.com/images/M/MV5BNDE5YmMxYjEtZjNjNC00NjM2LWE2ZjctOTkyNGMxODRiMGNiXkEyXkFqcGdeQXVyNTgyNTA4MjM@._V1_UY67_CR1,0,45,67_AL_.jpg" width="45" height="67" alt="Pather Panchali"></a></td><td class="titleColumn">1. <a href="/title/tt0048473/?pf_rd_m=A2FGELUUNOQJNL&amp;pf_rd_p=690bec67-3bd7-45a1-9ab4-4f274a72e602&amp;pf_rd_r=6SQY242HSENKQ6HKJAR9&amp;pf_rd_s=center-4&amp;pf_rd_t=60601&amp;pf_rd_i=india.top-rated-indian-movies&amp;ref_=fea_india_ss_toprated_tt_1" title="Satyajit Ray (dir.), Kanu Bannerjee, Karuna Bannerjee">Pather Panchali</a> <span class="secondaryInfo">(1955)</span></td><td class="ratingColumn imdbRating"><strong title="8.5 based on 22,843 user ratings">8.5</strong></td><td class="ratingColumn"><div class="seen-widget seen-widget-tt0048473" data-titleid="tt0048473"><div class="boundary"><div class="popover"><span class="delete">&nbsp;</span><ol><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li><li>8</li><li>9</li><li>10</li></ol></div></div><div class="inline"><div class="pending"></div><div class="unseeable">NOT YET RELEASED</div><div class="unseen"></div><div class="rating"></div><div class="seen">Seen</div></div></div></td><td class="watchlistColumn"><div class="wlb_ribbon" data-tconst="tt0048473" data-recordmetrics="true" style="position:relative"><div class="wl-ribbon standalone not-inWL" title="Click to add to watchlist"></div></div></td></tr><tr><td class="posterColumn"><span name="rk" data-value="2"></span> <span name="ir" data-value="8.470397312317216"></span> <span name="us" data-value="1.5386976E12"></span> <span name="nv" data-value="21637"></span> <span name="ur" data-value="-2.529602687682784"></span> <a href="/title/tt7060344/?pf_rd_m=A2FGELUUNOQJNL&amp;pf_rd_p=690bec67-3bd7-45a1-9ab4-4f274a72e602&amp;pf_rd_r=6SQY242HSENKQ6HKJAR9&amp;pf_rd_s=center-4&amp;pf_rd_t=60601&amp;pf_rd_i=india.top-rated-indian-movies&amp;ref_=fea_india_ss_toprated_tt_2"><img src="https://m.media-amazon.com/images/M/MV5BMjU2NzIzMjYtMGE2ZS00YzgzLWE5MzgtZTFiYTlmOWNlYmJkXkEyXkFqcGdeQXVyODIwMDI1NjM@._V1_UY67_CR2,0,45,67_AL_.jpg" width="45" height="67" alt="Raatchasan"></a></td><td class="titleColumn">2. <a href="/title/tt7060344/?pf_rd_m=A2FGELUUNOQJNL&amp;pf_rd_p=690bec67-3bd7-45a1-9ab4-4f274a72e602&amp;pf_rd_r=6SQY242HSENKQ6HKJAR9&amp;pf_rd_s=center-4&amp;pf_rd_t=60601&amp;pf_rd_i=india.top-rated-indian-movies&amp;ref_=fea_india_ss_toprated_tt_2" title="Ram Kumar (dir.), Vishnu Vishal, Radha Ravi">Raatchasan</a> <span class="secondaryInfo">(2018)</span></td><td class="ratingColumn imdbRating"><strong title="8.5 based on 21,637 user ratings">8.5</strong></td><td class="ratingColumn"><div class="seen-widget seen-widget-tt7060344" data-titleid="tt7060344"><div class="boundary"><div class="popover"><span class="delete">&nbsp;</span><ol><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li><li>8</li><li>9</li><li>10</li></ol></div></div><div class="inline"><div class="pending"></div><div class="unseeable">NOT YET RELEASED</div><div class="unseen"></div><div class="rating"></div><div class="seen">Seen</div></div></div></td><td class="watchlistColumn"><div class="wlb_ribbon" data-tconst="tt7060344" data-recordmetrics="true" style="position:relative"><div class="wl-ribbon standalone not-inWL" title="Click to add to watchlist"></div></div></td></tr></tbody></table></div>`
	server := httptest.NewServer(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
		w.Header().Set("Content-Type", "text/html")
		if r.URL.Path == "/" {
			fmt.Fprintln(w, response)
		}
		fmt.Fprintln(w, "404 Not Found")
	}))
	defer server.Close()

	movies := make([]string, 250)
	movies1 := make([]string, 250)
	movies[0] = "https://www.imdb.com//title/tt0048473/?pf_rd_m=A2FGELUUNOQJNL&pf_rd_p=690bec67-3bd7-45a1-9ab4-4f274a72e602&pf_rd_r=6SQY242HSENKQ6HKJAR9&pf_rd_s=center-4&pf_rd_t=60601&pf_rd_i=india.top-rated-indian-movies&ref_=fea_india_ss_toprated_tt_1"
	movies[1] = "https://www.imdb.com//title/tt7060344/?pf_rd_m=A2FGELUUNOQJNL&pf_rd_p=690bec67-3bd7-45a1-9ab4-4f274a72e602&pf_rd_r=6SQY242HSENKQ6HKJAR9&pf_rd_s=center-4&pf_rd_t=60601&pf_rd_i=india.top-rated-indian-movies&ref_=fea_india_ss_toprated_tt_2"

	type args struct {
		url string
	}
	tests := []struct {
		name    string
		s       *scrap
		args    args
		want    []string
		wantErr bool
	}{
		{
			name: "Happy Path - Successfully Parsing",
			args: args{
				url: server.URL,
			},
			want: movies,
		},
		{
			name: "No Movies Found",
			args: args{
				url: fmt.Sprintf("%s/%s", server.URL, "some-404-url"),
			},
			want: movies1,
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			s := &scrap{}
			got, err := s.GetTopMoviesURL(tt.args.url)
			if (err != nil) != tt.wantErr {
				t.Errorf("scrap.GetTopMoviesURL() error = %v, wantErr %v", err, tt.wantErr)
				return
			}
			if !reflect.DeepEqual(got, tt.want) {
				t.Errorf("scrap.GetTopMoviesURL() = %v, want %v", got, tt.want)
			}
		})
	}
}

func TestNewScrapper(t *testing.T) {
	tests := []struct {
		name string
		want Scrapper
	}{
		{
			name: "Happy Path",
			want: &scrap{},
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			if got := NewScrapper(); !reflect.DeepEqual(got, tt.want) {
				t.Errorf("NewScrapper() = %v, want %v", got, tt.want)
			}
		})
	}
}
